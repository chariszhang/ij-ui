import{getCurrentInstance as e,watchEffect as t,nextTick as n,onUpdated as r,onBeforeUnmount as i,isRef as s}from"vue";const a={required(e,t){if(t&&function(e){if(null==e||""===e||e!=e||Array.isArray(e)&&!e.length)return!0}(e))return"请填写此项"},maxLength(e,t){if(t=parseInt(t),e&&t&&String(e).length>t)return`输入内容不能超过${t}个字符。`},minLength(e,t){if(t=parseInt(t),e&&t>-1&&String(e).length<t)return`输入内容不能小于${t}个字符。`},min(e,t){if(t=parseFloat(t),u(+e)&&!isNaN(t)&&e<t)return`输入内容不能小于${t}。`},max(e,t){if(t=parseFloat(t),u(+e)&&!isNaN(t)&&e>t)return`输入内容不能大于${t}。`}};function u(e){return"number"==typeof e&&!isNaN(e)}function o({ref:u,props:o,valueKey:c="modelValue"},...d){let p,m,v=!1,y=e();async function h(){if(!function(){if(v)return v;const e=l(u);if(!e||!e.form)return;return function(e,t,n,r,i,a){if(e._patched)return void e._instances.push({instance:t,elementRef:n,props:r,valueKey:i,otherProps:a});e._instances=[{instance:t,elementRef:n,props:r,valueKey:i,otherProps:a}],e._patched=!0,e.addEventListener("submit",(function(){e.classList.add("v-submitted")})),e.addEventListener("reset",(function(t){e.classList.remove("v-submitted"),e._instances.forEach((({instance:e,elementRef:t,props:n,valueKey:r,otherProps:i})=>{l(t).disabled||(e.emit("update:"+r,Array.isArray(n[r])?[]:null),i.forEach((t=>{s(t)?t.value=null:e.emit("update:"+t,null)})))})),t.stopPropagation(),t.preventDefault()}))}(e.form,y,u,o,c,d),v=!0,v}())return;const e=l(u);if(!e||e.disabled)return;const t=o[c],n=o.validateRule;n&&(t===p&&JSON.stringify(n)===m||await async function(e,t,n){const r=function(e){var t=Object.keys(e),n=t.indexOf("required");n>-1&&(t.splice(n,1),t.unshift("required"));return t}(n),i=l(e);if(!i)return;for(let e=0;e<r.length;e++){const s=a[r[e]];if(s){const a=await Promise.resolve(s(t,n[r[e]]));if("required"===r[e]){if(f(i,!!a),a)return}else if(a)return void i.setCustomValidity(a)}}i.setCustomValidity("")}(u,t,n)),p=o[c],m=n?JSON.stringify(n):null}t((()=>n(h))),r((()=>n(h))),i((()=>{const e=l(u);e&&e.form&&function(e,t){if(e._patched){const n=e._instances.findIndex((e=>e.instance===t));e._instances.splice(n,1)}}(e.form,y)}))}function l(e){return!e.value||Array.isArray(e.value)&&!e.value.length?null:1===e.value.nodeType?e.value:e.value[0]}function f(e,t){e.matches("[type=checkbox],[type=radio]")?e.setCustomValidity(t?"请选择必选项。":""):e.required=t}export{o as r};
